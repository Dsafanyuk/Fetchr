<template>
      <!-- Image and text -->
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="collapse navbar-collapse" id="navbarTogglerDemo03">
          <ul class="custom_url col-md-4 navbar-nav  mt-2 ">
            <li class="nav-item active">
              <img v-on:click="goToDashboard" src="../images/fetchr_header_logo.png"  height="70" class="d-inline-block align-top" align="left">
            </li>
          </ul>
          <form class="col-md-4 form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2 " size="40" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-dark my-2 my-sm-0" type="submit">Search</button>
          </form>
          <div class="col-md-4 ">
            <div class=" icons_div btn-group " style=" float: right;">
<<<<<<< HEAD
             <button type="button" class="btn btn-secondary">Hi, {{ firstName }}</button>
=======
             <button type="button" class="btn btn-secondary">Hi, {{ user.first_name }}</button>
>>>>>>> 7794b290246fcc885b48c2f25b00f45542933c8c
             <button type="button" class="btn btn-secondary btn_space dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
             <span class="sr-only">Toggle Dropdown</span>
            </button>
               <div class="dropdown-menu">
               <a class="dropdown-item" href="#">My Account</a>
               <a class="dropdown-item" v-on:click="gotoOrders">My Orders</a>
               <div class="dropdown-divider"></div>
               <a v-on:click='logout()' class="dropdown-item" href="#">Log Out</a>
               </div>
          <a id="cart" href="#" v-on:click="showShoppingCart"> <i id="cart" class="fas fa-shopping-cart fa-xs"></i></a>
          </div>
        </div>
      </div>
    </nav>

</template>
<script>
import Landing from '../Landing.vue';
import ShoppingCart from './ShoppingCart.vue'
import browsercookies from 'browser-cookies';
import axios from 'axios';

const api = axios.create({
  withCredentials: true,
});

export default {
  data() {
    name: 'LandingHeader';
    return {
<<<<<<< HEAD
      firstName: browsercookies.get('first_name')
=======
      user: {}
>>>>>>> 7794b290246fcc885b48c2f25b00f45542933c8c
    };
  },
  mounted: function() {
    console.log(browsercookies.get('authCookie'))

    api.get(`http://127.0.0.1:3000/api/users/${browsercookies.get('userId')}`, {
      headers: {
        authtoken: browsercookies.get('authCookie')
      }
    })
      .then((response) => {
        if (response.status == 200) {
<<<<<<< HEAD
          // Make cookies from user information, response.data[0] is an Obj
          for(let userDetail in response.data[0]) {
            let userValue = response.data[0][userDetail]
            browsercookies.set(userDetail, `${userValue}`);
          }
=======
          this.user = response.data[0];
>>>>>>> 7794b290246fcc885b48c2f25b00f45542933c8c
        }
      })
      .catch((error) => {
        console.log(error);
      });
  },
  components: {
    ShoppingCart: ShoppingCart
  },
  methods: {
    showShoppingCart: function  ()
    {

      this.$emit('showcart', 'show');
    },

    logout: function() {
        browsercookies.erase('userId');
        browsercookies.erase('authCookie');
        window.location.href = 'http://127.0.0.1:8080/login';
    },
    goToDashboard: function() {
      this.$router.push('/dashboard');
    },
    gotoOrders: function() {
      this.$router.push('/orders')
    }
  }
};
</script>

<style lang="css">
@import '../custom_css/landing.scss';
@import 'https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css';
@import 'https://use.fontawesome.com/releases/v5.4.1/css/all.css';
@import 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css';
@import 'https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js';
@import 'https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js';

.icons_div {
float : right ;
}

.btn_space {
  margin-right: 10px;
}
</style>
